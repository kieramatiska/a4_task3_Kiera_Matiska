---
title: "Bonanza Snowshoe Hares"
author: "Kiera Matiska"
date: "11/5/2021"
output: html_document
---
# Introduction

# Data and Analyses

## Citations

Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

# Attach Packages
library(tidyverse)
library(here)
library(lubridate)
library(kableExtra)
library(effsize)
```

# Read in data

- Use `read_csv()` and the here package to read in bonanza_hares.csv.

```{r}
hares <- read_csv(here("data", "bonanza_hares.csv")) # reads in data
```

# 1. Annual Juvinile Hare Trap Counts

## Data Wrangling

- Create a new column, year, using the `year()` function in lubridate
- Create a subset that only contains juvenile hare data
- Create a new data frame using the `summarize()` function that has two columns, year and number of hare traps
- Use `kable_styling()` to finalize the table

```{r}
hares_year <- hares %>% # stores new subset
  mutate(date = mdy(date)) %>% # changes date column to class date
  mutate(year = year(date)) # adds a new column with just year

hares_juvenile <- hares_year %>% # stores new subset
  filter(age == "j") # filters out observations in the age column that is not "j"

hares_traps <- hares_juvenile %>% # stores a new subset
  select(year, age) %>% # selects only columns age and year
  group_by(year) %>% # groups the subset by year
  summarize(number = n()) # creates a summary table with only year and number of traps for juvenile hares

hares_traps %>% # finalize this table
  kbl(caption = "Table 1. Number of Juvenile Hare Traps Each Year from 1999 - 2012") %>% # adds a caption
  kable_styling()
```

## Visualize Data

Create a column graph using `ggplot()`

```{r}
ggplot(data = hares_traps, # identifies data set
       aes(x = year, y = number)) + # sets x and y axis
  geom_col(color = "gray", fill = "darkblue") + # makes a column graph and adds color to data
  scale_x_continuous(breaks = 1999:2012) + # add each year label under observations
  labs(x = "Year", # titles x-axis
       y = "Number of Traps", # titles y-axis
       caption = expression(
         paste(
           bold("Figure 1."), " Annual Counts of Juvenile Hare Traps in Bonanza Creek"))) + # creates a figure caption
  theme(plot.caption = element_text(hjust = 0), # positions figure label to the bottom left of the graph
        plot.background = element_rect(fill = "lavender"), # changes the plot background color
        panel.background = element_rect(fill = "gray94"), # changes the panel background color
        panel.grid.major = element_line(color = "snow3")) # change color of lines on the panel
```

Figure 1: Annual Counts of Juvenile Hare Traps in Bonanza Creek

## Major Takeaways

The maximum and minimum amount of Juvenile Hare Trappings are 126 (in 1999) and 2 (in 2009) respectively. The median number of traps is 30.5 and the mean value is 31.5 traps. Therefore, there is a substantial decrease after the first year, which had 126 juvenile traps. After 1999, the general trend of the juvenile traps is negative, meaning that overall, the trap counts decrease from the first year.

# 2. Juvenile Hare Weights

## Data Wrangling

- Using `mutate()`, rename the sex variables so they are spelled out: m = male, f = female, and NA = not applicable
- Using `mutate()`, reame the grid variables so they are spelled out: bonrip = Bonanza Riparian, bonmat = Bonanza Mature, bonbs = Bonanza Lowland Mature
- Create new data frame, hare_weights, using the `select()` function so that it contains only hare weights, sex, and grid site.

```{r}
hares_sex <- hares_juvenile %>% # stores new subset
  mutate(sex = case_when( # renames variables in the sex column
    sex == "m" ~ "male", 
    sex == "f" ~ "female",
    is.na(sex) == TRUE ~ "N/A" # changes NA filler variables to N/A for not applicable
  ))

hare_grids <- hares_sex %>% # stores new subset
  mutate(grid = case_when( # renames variables in grid column
    grid == "bonrip" ~ "Bonanza Riparian",
    grid == "bonmat" ~ "Bonanza Mature",
    grid == "bonbs" ~ "Bonanza Lowland Mature"
  ))

hare_weights <- hare_grids %>% # stores a new subset
  select(weight, sex, grid) # with only these columns
```

## Data Visualization

Create a graph of the hare_weights data:
- Facet by sex
- Change label names
- Add a figure caption

```{r}
ggplot(data = hare_weights, # identifies data set
       aes(x = sex, y = weight)) + # sets x and y variables
  geom_point(size = 0.8, aes(color = sex)) + # scatter plot with colors based on sex size change of each point
  facet_grid(~ grid) + # separate data on graph by site
  labs(x = "Sex", # x-axis label
       y = "Weight (g)", # y-axis label
       caption = expression(
         paste(
           bold("Figure 2."), " Juvenile Hare Weights (g) by Sex in Each Bonanza Creek Site Zone" # adds figure caption
         )
       )) +
  theme(legend.position = "none", # removes legend
        plot.caption = element_text(hjust = 0), # positions figure label to the bottom left of the graph
        plot.background = element_rect(fill = "lavender"), # changes the plot background color
        panel.background = element_rect(fill = "gray94"), # changes the panel background color
        panel.grid.major = element_line(color = "snow3")) # change color of lines on the panel
```

## Major Takeaways

From these graphs, I would suggest that on average, female juvenile hares are smaller than male hares in two of the three sites. The site where female hares appear to be larger is at the Lowland Bonanza Mature site.

# 3. Juvenile Weight Comparisons (male and female snowshoe hares)

## Wrangle Data

Create a data subset, `weight_hare` with only the variables sex and weight

```{r}
weight_hare <- hares_sex %>% # stores a new subset
  select(sex, weight) %>% # with only these columns
  filter(sex %in% c("male", "female")) # without NA data
```

## Summarize Data

Create and finalize a summary table that contains the mean, standard deviation, and sample size for male and female juvenile hares
- Use the `summarize` and `group_by` functions to find weight statistics based on sex
- Use `kableExtra` to finalize table and add table caption

```{r}
hare_summary <- weight_hare %>% # stores a summary table
  group_by(sex) %>% # group by sex
  summarize(mean(weight, na.rm = TRUE), # mean the weight, remove NA values
            sd(weight, na.rm = TRUE), # standard deviate the weight, remove NA values
            sample_size = n()) # calculate sample size

hare_summary %>% # finalize summary table
  kbl(caption = "Table 2: Mean, Standard Deviation, and Sample Sizes of Weights by Sex of Juvenile Hares") %>% # add a caption
  kable_styling()
```

```{r, include = FALSE}
# Create vectors of hare weights 
weight_males <- hares_sex %>% # Stores a vector
  filter(sex == "male") %>% # with only male observations
  drop_na(weight) %>% # dropping weights with NA stored
  pull(weight) # separates weight values into vector

weight_females <- hares_sex %>% # stores a vector
  filter(sex == "female") %>% # with only male observations
  drop_na(weight) %>% # dropping weights with NA stored
  pull(weight) # separates weight values into vector
```

```{r, include = FALSE}
hist(weight_males) # create a histogram for male weights

hist(weight_females) # create a histogram for female weights

qqplot(weight_males, weight_females) # create a qqplot of male and female weights
```

## Perform a t-test on the data

Use `t.test()` to run the test and find significance of the data. Use `cohen.d()` to run a cohens d test.

```{r}
weight_ttest <- t.test(weight_males, weight_females) # conduct t-test

weight_cohen <- cohen.d(weight_males, weight_females) # conduct cohen d's test
```

## Key Takeaways

# 4. Relationship Between Juvenile Weight and Hind Foot Length

## Data Wrangling

Create a new subset that consists of only juvenile hares, weights, and hind foot lengths in mm

```{r}
weight_hind <- hares_juvenile %>% # stores new subset
  select(weight, hindft) # with only these columns
```

## Data Visualization

Create a scatter plot using `geom_point()` that plots weight (x-axis) against hind foot length (y-axis)

```{r}
ggplot(data = weight_hind, # select this data
       aes(x = weight, y = hindft)) + # selects x and y variables
  geom_point(color = "springgreen4") + # scatter plot with green points
  labs(x = "Weight (g)", # x-axis label
       y = "Hind Foot Length (mm)", # y-axis label
       caption = expression(
         paste(
           bold("Figure 3."), " Weight vs Hind Foot Length of Juvenile Hares. Weight is in grams and hind foot length is in millimeters."))) + # adds figure caption
  theme(plot.caption = element_text(hjust = 0), # positions figure label to the bottom left of the graph
        plot.background = element_rect(fill = "lavender"), # changes the plot background color
        panel.background = element_rect(fill = "gray94"), # changes the panel background color
        panel.grid.major = element_line(color = "snow3")) # change color of lines on the panel
```

## Statistical Testing

Create a linear regression model of the data

```{r}
weight_hind_lm <- lm(weight ~ hindft, data = weight_hind) # run a linear regression test
```

## Key Takeaways

# Summary

# Citations

Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14

# End Task
